<!DOCTYPE html>
<html>
<head>
    <title>Forma Medical - Admin Portal</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 80vh;
        }
        
        .login-card {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        
        .logo {
            width: 120px;
            height: auto;
            margin-bottom: 30px;
        }
        
        .login-title {
            color: #2c5aa0;
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .login-subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c5aa0;
            font-weight: bold;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        .login-btn {
            width: 100%;
            background: #2c5aa0;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .login-btn:hover {
            background: #1e4080;
        }
        
        .error-message {
            color: red;
            margin-top: 15px;
            display: none;
        }
        
        .success-message {
            color: green;
            margin-top: 15px;
            display: none;
        }
        
        .admin-dashboard {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .dashboard-title {
            color: #2c5aa0;
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #2c5aa0;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #2c5aa0;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 14px;
        }
        
        .section-title {
            color: #2c5aa0;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            border-bottom: 2px solid #2c5aa0;
            padding-bottom: 10px;
        }
        
        .btn {
            background: #2c5aa0;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            background: #1e4080;
        }
        
        .btn-danger {
            background: #dc3545;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .logout-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .distributor-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #2c5aa0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .distributor-name {
            font-weight: bold;
            color: #2c5aa0;
            margin-bottom: 5px;
        }
        
        .distributor-actions {
            display: flex;
            gap: 10px;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            margin: 2% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            border-bottom: 2px solid #2c5aa0;
            padding-bottom: 15px;
        }
        
        .modal-title {
            color: #2c5aa0;
            font-size: 24px;
            font-weight: bold;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-row-single {
            margin-bottom: 20px;
        }
        
        .commission-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #2c5aa0;
        }
        
        .commission-section h3 {
            color: #2c5aa0;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .commission-rule {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid #dee2e6;
        }
        
        .commission-rule-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .rule-type-select {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-right: 10px;
        }
        
        .remove-rule-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .add-rule-btn {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .distributor-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .distributor-actions {
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <img src="Forma Medical transparent.png" alt="Forma Medical" class="logo">
            <h1 class="login-title">Admin Portal</h1>
            <p class="login-subtitle">Forma Medical Management System</p>
            
            <div class="form-group">
                <label>Username</label>
                <input type="text" id="username">
            </div>
            
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="password">
            </div>
            
            <button class="login-btn" onclick="doLogin()">Access Admin Portal</button>
            
            <div id="errorMsg" class="error-message">Invalid username or password</div>
            <div id="successMsg" class="success-message">Login successful!</div>
        </div>
    </div>

    <div id="adminDashboard" class="admin-dashboard">
        <button class="logout-btn" onclick="doLogout()">Logout</button>
        
        <h1 class="dashboard-title">Admin Dashboard</h1>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalDistributorsCount">3</div>
                <div class="stat-label">Total Distributors</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">$12,450</div>
                <div class="stat-label">Monthly Commissions</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">32%</div>
                <div class="stat-label">Avg Commission Rate</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">47</div>
                <div class="stat-label">Active Submissions</div>
            </div>
        </div>

        <h2 class="section-title">Distributor Management</h2>
        <button class="btn" onclick="showAddDistributorModal()">Add New Distributor</button>
        <button class="btn btn-success" onclick="exportData()">Export Data</button>
        
        <div id="distributorsList" style="margin-top: 20px;">
            <div class="distributor-item">
                <div>
                    <div class="distributor-name">ABC Ortho Solutions</div>
                    <div>Code: ABCORTHO | Contact: John Smith | Rate: 30% (+40% new surgeons)</div>
                </div>
                <div class="distributor-actions">
                    <button class="btn" onclick="editDistributor('ABCORTHO')">Edit</button>
                    <button class="btn btn-danger" onclick="deleteDistributor('ABCORTHO')">Delete</button>
                </div>
            </div>
            
            <div class="distributor-item">
                <div>
                    <div class="distributor-name">MedSupply Pro</div>
                    <div>Code: MEDSUPPLY | Contact: Sarah Johnson | Rate: 30% Hammertoe, 35% MTP</div>
                </div>
                <div class="distributor-actions">
                    <button class="btn" onclick="editDistributor('MEDSUPPLY')">Edit</button>
                    <button class="btn btn-danger" onclick="deleteDistributor('MEDSUPPLY')">Delete</button>
                </div>
            </div>
            
            <div class="distributor-item">
                <div>
                    <div class="distributor-name">Surgical Solutions Inc</div>
                    <div>Code: SURGSOL | Contact: Mike Wilson | Rate: 30% (Dr. Wilson immediate payout)</div>
                </div>
                <div class="distributor-actions">
                    <button class="btn" onclick="editDistributor('SURGSOL')">Edit</button>
                    <button class="btn btn-danger" onclick="deleteDistributor('SURGSOL')">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Distributor Modal -->
    <div id="distributorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Add New Distributor</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            
            <form id="distributorForm" onsubmit="saveDistributor(event)">
                <!-- Basic Info -->
                <div class="commission-section">
                    <h3>Basic Information</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Company Name *</label>
                            <input type="text" id="companyName" required>
                        </div>
                        <div class="form-group">
                            <label>Access Code *</label>
                            <input type="text" id="accessCode" required style="text-transform: uppercase;">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Contact Name *</label>
                            <input type="text" id="contactName" required>
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="contactEmail">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Phone</label>
                            <input type="tel" id="contactPhone">
                        </div>
                        <div class="form-group">
                            <label>Default Commission Rate (%)</label>
                            <input type="number" id="defaultRate" min="0" max="100" value="30">
                        </div>
                    </div>
                </div>

                <!-- Commission Rules -->
                <div class="commission-section">
                    <h3>Commission Rules</h3>
                    <p style="color: #666; margin-bottom: 15px;">Add specific commission rules for different scenarios</p>
                    
                    <div id="commissionRules">
                        <!-- Rules will be added here dynamically -->
                    </div>
                    
                    <button type="button" class="add-rule-btn" onclick="addCommissionRule()">+ Add Commission Rule</button>
                </div>

                <div style="margin-top: 30px; text-align: center;">
                    <button type="submit" class="btn btn-success">Save Distributor</button>
                    <button type="button" class="btn" onclick="closeModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        console.log('Enhanced admin script loaded');
        
        var ruleCounter = 0;
        var distributors = [];
        
        function doLogin() {
            console.log('Login function called');
            
            var user = document.getElementById('username').value;
            var pass = document.getElementById('password').value;
            
            var errorDiv = document.getElementById('errorMsg');
            var successDiv = document.getElementById('successMsg');
            
            errorDiv.style.display = 'none';
            successDiv.style.display = 'none';
            
            if ((user === 'admin' && pass === 'forma2025') || (user === 'formamedical' && pass === 'admin123')) {
                console.log('Login SUCCESS');
                successDiv.style.display = 'block';
                
                setTimeout(function() {
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('adminDashboard').style.display = 'block';
                }, 1000);
                
            } else {
                console.log('Login FAILED');
                errorDiv.style.display = 'block';
            }
        }
        
        function doLogout() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('adminDashboard').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('errorMsg').style.display = 'none';
            document.getElementById('successMsg').style.display = 'none';
        }
        
        function showAddDistributorModal() {
            document.getElementById('modalTitle').textContent = 'Add New Distributor';
            document.getElementById('distributorForm').reset();
            document.getElementById('commissionRules').innerHTML = '';
            ruleCounter = 0;
            document.getElementById('distributorModal').style.display = 'block';
        }
        
        function closeModal() {
            document.getElementById('distributorModal').style.display = 'none';
        }
        
        function addCommissionRule() {
            ruleCounter++;
            var rulesContainer = document.getElementById('commissionRules');
            
            var ruleDiv = document.createElement('div');
            ruleDiv.className = 'commission-rule';
            ruleDiv.id = 'rule_' + ruleCounter;
            
            ruleDiv.innerHTML = `
                <div class="commission-rule-header">
                    <select class="rule-type-select" onchange="updateRuleInputs(${ruleCounter})" id="ruleType_${ruleCounter}">
                        <option value="">Select Rule Type</option>
                        <option value="surgery">Based on Surgery Type</option>
                        <option value="surgeon">Based on Surgeon</option>
                        <option value="new_surgeon">New Surgeon Bonus</option>
                        <option value="immediate_payout">Immediate Payout Surgeon</option>
                    </select>
                    <button type="button" class="remove-rule-btn" onclick="removeRule(${ruleCounter})">Remove</button>
                </div>
                <div id="ruleInputs_${ruleCounter}">
                    <!-- Dynamic inputs will be added here -->
                </div>
            `;
            
            rulesContainer.appendChild(ruleDiv);
        }
        
        function updateRuleInputs(ruleId) {
            var ruleType = document.getElementById('ruleType_' + ruleId).value;
            var inputsContainer = document.getElementById('ruleInputs_' + ruleId);
            
            var html = '';
            
            if (ruleType === 'surgery') {
                html = `
                    <div class="form-row">
                        <div class="form-group">
                            <label>Surgery Type</label>
                            <select id="surgeryType_${ruleId}">
                                <option value="Hammertoe">Hammertoe</option>
                                <option value="MTP">MTP</option>
                                <option value="Lapidus">Lapidus</option>
                                <option value="Akin">Akin</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Commission Rate (%)</label>
                            <input type="number" id="surgeryRate_${ruleId}" min="0" max="100" value="30">
                        </div>
                    </div>
                `;
            } else if (ruleType === 'surgeon') {
                html = `
                    <div class="form-row">
                        <div class="form-group">
                            <label>Surgeon Name</label>
                            <input type="text" id="surgeonName_${ruleId}" placeholder="e.g., Dr. Smith">
                        </div>
                        <div class="form-group">
                            <label>Commission Rate (%)</label>
                            <input type="number" id="surgeonRate_${ruleId}" min="0" max="100" value="30">
                        </div>
                    </div>
                `;
            } else if (ruleType === 'new_surgeon') {
                html = `
                    <div class="form-row">
                        <div class="form-group">
                            <label>New Surgeon Bonus Rate (%)</label>
                            <input type="number" id="newSurgeonRate_${ruleId}" min="0" max="100" value="40">
                        </div>
                        <div class="form-group">
                            <label>Effective Date</label>
                            <input type="date" id="effectiveDate_${ruleId}">
                        </div>
                    </div>
                `;
            } else if (ruleType === 'immediate_payout') {
                html = `
                    <div class="form-row">
                        <div class="form-group">
                            <label>Surgeon Name (Immediate Payout)</label>
                            <input type="text" id="immediateSurgeon_${ruleId}" placeholder="e.g., Dr. Wilson">
                        </div>
                        <div class="form-group">
                            <label>Commission Rate (%)</label>
                            <input type="number" id="immediateRate_${ruleId}" min="0" max="100" value="30">
                        </div>
                    </div>
                `;
            }
            
            inputsContainer.innerHTML = html;
        }
        
        function removeRule(ruleId) {
            var ruleElement = document.getElementById('rule_' + ruleId);
            ruleElement.remove();
        }
        
        function saveDistributor(event) {
            event.preventDefault();
            
            var companyName = document.getElementById('companyName').value;
            var accessCode = document.getElementById('accessCode').value.toUpperCase();
            var contactName = document.getElementById('contactName').value;
            var contactEmail = document.getElementById('contactEmail').value;
            var contactPhone = document.getElementById('contactPhone').value;
            var defaultRate = document.getElementById('defaultRate').value;
            
            // Collect commission rules
            var rules = [];
            var ruleElements = document.querySelectorAll('.commission-rule');
            
            ruleElements.forEach(function(ruleElement) {
                var ruleId = ruleElement.id.split('_')[1];
                var ruleType = document.getElementById('ruleType_' + ruleId).value;
                
                if (ruleType) {
                    var rule = { type: ruleType };
                    
                    if (ruleType === 'surgery') {
                        rule.surgeryType = document.getElementById('surgeryType_' + ruleId).value;
                        rule.rate = document.getElementById('surgeryRate_' + ruleId).value;
                    } else if (ruleType === 'surgeon') {
                        rule.surgeonName = document.getElementById('surgeonName_' + ruleId).value;
                        rule.rate = document.getElementById('surgeonRate_' + ruleId).value;
                    } else if (ruleType === 'new_surgeon') {
                        rule.rate = document.getElementById('newSurgeonRate_' + ruleId).value;
                        rule.effectiveDate = document.getElementById('effectiveDate_' + ruleId).value;
                    } else if (ruleType === 'immediate_payout') {
                        rule.surgeonName = document.getElementById('immediateSurgeon_' + ruleId).value;
                        rule.rate = document.getElementById('immediateRate_' + ruleId).value;
                    }
                    
                    rules.push(rule);
                }
            });
            
            // Create distributor object
            var distributor = {
                companyName: companyName,
                accessCode: accessCode,
                contactName: contactName,
                contactEmail: contactEmail,
                contactPhone: contactPhone,
                defaultRate: defaultRate,
                commissionRules: rules
            };
            
            // Add to distributors array (in real app, this would save to database)
            distributors.push(distributor);
            
            // Add to the UI
            addDistributorToUI(distributor);
            
            // Update count
            updateDistributorsCount();
            
            alert('Distributor added successfully!');
            closeModal();
        }
        
        function addDistributorToUI(distributor) {
            var distributorsList = document.getElementById('distributorsList');
            
            // Build rules summary
            var rulesSummary = 'Rate: ' + distributor.defaultRate + '%';
            if (distributor.commissionRules.length > 0) {
                var ruleTexts = [];
                distributor.commissionRules.forEach(function(rule) {
                    if (rule.type === 'surgery') {
                        ruleTexts.push(rule.surgeryType + ' ' + rule.rate + '%');
                    } else if (rule.type === 'new_surgeon') {
                        ruleTexts.push('New surgeons ' + rule.rate + '%');
                    } else if (rule.type === 'immediate_payout') {
                        ruleTexts.push(rule.surgeonName + ' immediate payout');
                    }
                });
                if (ruleTexts.length > 0) {
                    rulesSummary += ' (' + ruleTexts.join(', ') + ')';
                }
            }
            
            var distributorDiv = document.createElement('div');
            distributorDiv.className = 'distributor-item';
            distributorDiv.innerHTML = `
                <div>
                    <div class="distributor-name">${distributor.companyName}</div>
                    <div>Code: ${distributor.accessCode} | Contact: ${distributor.contactName} | ${rulesSummary}</div>
                </div>
                <div class="distributor-actions">
                    <button class="btn" onclick="editDistributor('${distributor.accessCode}')">Edit</button>
                    <button class="btn btn-danger" onclick="deleteDistributor('${distributor.accessCode}')">Delete</button>
                </div>
            `;
            
            distributorsList.appendChild(distributorDiv);
        }
        
        function updateDistributorsCount() {
            var currentCount = parseInt(document.getElementById('totalDistributorsCount').textContent);
            document.getElementById('totalDistributorsCount').textContent = currentCount + 1;
        }
        
        function editDistributor(code) {
            alert('Edit distributor: ' + code + ' - Coming soon!');
        }
        
        function deleteDistributor(code) {
            if (confirm('Are you sure you want to delete this distributor?')) {
                alert('Distributor deleted: ' + code);
                // Here you would remove from UI and database
            }
        }
        
        function exportData() {
            alert('Exporting distributor data...');
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            var modal = document.getElementById('distributorModal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>
